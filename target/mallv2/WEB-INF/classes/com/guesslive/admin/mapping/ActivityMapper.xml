<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.guesslive.admin.dao.ActivityMapper">

	<!-- 更新活动 时间-->
	<insert id="updateActive" parameterType="GoodsActive">
		update t_goods_active set starttime=#{starttime}, endtime=#{endtime}
		where goodsid = #{goodsid}
	</insert>
	
	<delete id="deleteActive" parameterType="int">
		delete from t_goods_active where goodsid=#{goodsid}
	</delete>
	
	<delete id="deleteActiveShare" parameterType="int">
		delete from t_goods_active_share where goodsid=#{goodsid}
	</delete>
	
	<!-- 删除乐享折扣用户分享记录 -->
	<delete id="deleteShareAccount" parameterType="int">
		delete from t_active_share_account where goodsid = #{goodsid}
	</delete>
	
	<resultMap type="Goods" id="goodsMap">
		<result column="goodsid" property="goodsid"/>
		<result column="goodssn" property="goodssn"/>
		<result column="goodsname" property="goodsname"/>
		<result column="agentname" property="agentname"/>
		<result column="iconurl" property="iconurl"/>
		<result column="cate" property="cate"/>
		<result column="subcate" property="subcate"/>
		<result column="saleprice" property="saleprice"/>
		<result column="status" property="status"/>
	</resultMap>
	
	<resultMap type="GoodsActive" id="goodsActiveMap">
		<result column="goodsid" property="goodsid"/>
		<result column="type" property="type"/>
		<result column="starttime" property="starttime"/>
		<result column="endtime" property="endtime"/>
		<result column="weight" property="weight"/>
		<association property="goods" resultMap="goodsMap"></association>
	</resultMap>
	
	<select id="selectActiveGoodsList" resultMap="goodsActiveMap">
	   	SELECT
			g.goodsid,
			g.goodssn,
			g.goodsname,
			g.saleprice,
			g.agentname,
			g.cate,
			g.subcate,
			g.iconurl,
			g.status,
			ga.starttime,
			ga.endtime,
			ga.type,
			ga.weight
		FROM
			t_goods_active ga
		LEFT JOIN t_goods g ON ga.goodsid = g.goodsid
		<where>
		  	<if test="ga.goods != null and ga.goods.goodsname != null and ga.goods.goodsname != ''">
		  		and g.goodsname like concat('%',#{ga.goods.goodsname},'%')
		  	</if>
		  	<if test="ga.goods != null and ga.goods.goodssn != null and ga.goods.goodssn != ''">
		  		and g.goodssn like concat('%',#{ga.goods.goodssn},'%')
		 	</if>
		 	<if test="ga.goods != null and ga.goods.status != null and ga.goods.status != ''">
		  		and g.status = #{ga.goods.status}
		 	</if>
		 	<if test="ga.type != null and ga.type != ''">
		  		and ga.type = #{ga.type}
		 	</if>
		</where>
	  	ORDER BY ga.starttime DESC
   	  	limit #{start},#{rows}
	</select>
	
	<select id="selectActiveGoodsCount" resultType="int">
	   	select count(*) FROM t_goods_active ga
		LEFT JOIN t_goods g ON ga.goodsid = g.goodsid
		<where>
		  	<if test="goods != null and goods.goodsname != null and goods.goodsname != ''">
		  		and g.goodsname like concat('%',#{ga.goods.goodsname},'%')
		  	</if>
		  	<if test="goods != null and goods.goodssn != null and goods.goodssn != ''">
		  		and g.goodssn like concat('%',#{goods.goodssn},'%')
		 	</if>
		 	<if test="goods != null and goods.status != null and goods.status != ''">
		  		and g.status = #{goods.status}
		 	</if>
		 	<if test="type != null and type != ''">
		  		and ga.type = #{type}
		 	</if>
		</where>
	</select>
</mapper>