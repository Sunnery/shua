<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guesslive.admin.dao.AdminLogMapper">

	<!-- 添加操作日志 -->
	<insert id="insertLog" useGeneratedKeys="true" keyProperty="id"
		parameterType="AdminLog">
		insert into t_operate_admin_log
		(cuid,createuser,description,createtime) values
		(#{cuid},#{createuser},#{description},#{createtime})
	</insert>

	<select id="selectAllLog" resultType="AdminLog">
		select o.*,s.`name` name from t_operate_admin_log o LEFT JOIN t_sys_user s on o.createuser = s.account where 1=1
			<if test="log.createuser != '' and log.createuser != null">
				and o.createuser=#{log.createuser}
			</if>
			<if test="log.description != '' and log.description != null">
				and o.description like concat('%',#{log.description},'%')
			</if>
			<if test="log.starttime != null and log.starttime !=''">
				and o.createtime &gt;= #{log.starttime}
			</if>
			<if test="log.endtime != null and log.endtime !=''">
				and o.createtime &lt; #{log.endtime}
			</if>
		order by o.createtime desc
		limit #{start},#{rows}
	</select>

	<select id="selectCount" resultType="int">
		select count(*) from t_operate_admin_log where 1=1
			<if test="createuser != '' and createuser != null">
				and createuser=#{createuser}
			</if>
			<if test="description != '' and description != null">
				and description like concat('%',#{description},'%')
			</if>
			<if test="starttime != null and starttime !=''">
				and createtime &gt;= #{starttime}
			</if>
			<if test="endtime != null and endtime !=''">
				and createtime &lt; #{endtime}
			</if>
	</select>

</mapper>