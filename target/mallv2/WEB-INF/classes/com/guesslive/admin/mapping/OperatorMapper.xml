<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.guesslive.admin.dao.OperatorMapper">
	
	<resultMap type="Operator" id="operatorMap">
		<id property="userId" column="id" />
		<result property="account" column="account"  jdbcType="VARCHAR" />
		<result property="userName" column="name"  jdbcType="VARCHAR" />
		<result property="status" column="status"  jdbcType="VARCHAR" />
		<result property="roles" column="roles"  jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="getOperatorList" resultMap="operatorMap">
	   	SELECT
			t.id,
			t.account,
			t.`name`,
			t.status,
			(
				SELECT
					GROUP_CONCAT(DISTINCT r.role_name)
				FROM
					t_user_role ur,
					t_role r
				WHERE
					ur.user_id = t.id
				AND ur.role_id = r.role_id
			) roles
		FROM
			t_sys_user t
		<where>
			1=1
			  <if test="operator.userId != null and !''.equals(operator.userId)">
			  		and t.id = #{operator.userId}
			  </if>
			  <if test="operator.account != null and !''.equals(operator.account)">
			  		and t.account like concat('%',#{operator.account},'%')
			  </if>
			  <if test="operator.userName != null and !''.equals(operator.userName)">
		  			and t.`name` like concat('%',#{operator.userName},'%')
			  </if>
		</where>
		limit #{page.startRow},#{page.pageSize}
	</select>
	
	<select id="getOperatorListCount" resultType="int">
	   	SELECT
			count(1)
		FROM
			t_sys_user t
		<where>
			1=1
			  <if test="operator.userId != null and !''.equals(operator.userId)">
			  		and t.id = #{operator.userId}
			  </if>
			  <if test="operator.account != null and !''.equals(operator.account)">
			  		and t.account like concat('%',#{operator.account},'%')
			  </if>
			  <if test="operator.userName != null and !''.equals(operator.userName)">
		  			and t.`name` like concat('%',#{operator.userName},'%')
			  </if>
		</where>
	</select>
</mapper>